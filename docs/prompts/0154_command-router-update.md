---
wbs: "0008"
topic: "rd2:tasks Agent Skill Upgrade"
name: "Command Router Update"
description: "Update CLI router to use new adapters and support tool auto-detection"
status: Backlog
created_at: "2026-02-02"
updated_at: "2026-02-02"
impl_progress:
  planning: pending
  design: pending
  implementation: pending
  review: pending
  testing: pending
---

## 0154. Command Router Update

### Background

The current rd2:tasks CLI uses direct TodoWrite calls for all operations. The command router needs to be updated to:

1. Use the new tool abstraction layer for all operations
2. Support auto-detection of available tools
3. Maintain the same external interface for backward compatibility
4. Route commands to appropriate adapters based on tool availability

This is the integration point that exposes the new infrastructure through the existing CLI.

### Requirements

1. **Command Router Modification**: Update router to use ToolSelector instead of direct TodoWrite calls
2. **Auto-Detection Integration**: Initialize CompatibilityChecker on startup
3. **Command Mappings**:
   - `rd2:tasks create` -> Use TaskUpdateAdapter (or TodoWrite fallback)
   - `rd2:tasks list` -> Use TaskListAdapter (or TodoWrite fallback)
   - `rd2:tasks update` -> Use TaskUpdateAdapter (or TodoWrite fallback)
   - `rd2:tasks refresh` -> Use auto-detected tools for full sync
4. **User Feedback**: Inform user which tools are being used (new vs legacy)
5. **Error Handling**: Provide clear error messages when tools are unavailable

### Q&A

[Clarifications to be added during planning phase]

### Design

[Architecture specs to be added by specialists]

### Plan

1. Update command router to use ToolSelector
2. Add CompatibilityChecker initialization
3. Update each command handler to use appropriate adapter
4. Add tool usage logging
5. Update help text to reflect new capabilities
6. Add integration tests for each command

### Artifacts

| Type | Path | Generated By | Date |
| ---- | ---- | ------------ | ---- |

### References

- [Master Task: 0001_rd2-tasks-upgrade.md](/docs/prompts/0001_rd2-tasks-upgrade.md)
