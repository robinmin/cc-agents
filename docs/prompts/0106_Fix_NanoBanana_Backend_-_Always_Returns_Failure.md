---
name: Fix NanoBanana Backend - Always Returns Failure
description: Task: Fix NanoBanana Backend - Always Returns Failure
status: Done
created_at: 2026-01-29 23:05:12
updated_at: 2026-01-30 15:50:38
impl_progress:
  planning: completed
  design: completed
  implementation: completed
  review: completed
  testing: completed
---

## 0106. Fix NanoBanana Backend - Always Returns Failure

### Background

The `NanoBananaBackend` class in `plugins/wt/skills/image-generate/scripts/image_generator.py` has a confusing implementation where:
- `is_available()` always returns `True` (indicating the backend is ready to use)
- `generate()` always returns `success=False` with an error message directing users to use MCP tools directly

This creates a poor user experience where the backend appears available in the backend selection list but always "fails" when used. Users are misled into thinking they can use this backend directly, when in reality it requires external MCP tool invocation.

The current error message says:
```
"nano_banana backend requires MCP tool invocation. Use mcp__huggingface__gr1_z_image_turbo_generate..."
```

This should either:
1. Be a truly unavailable backend (not show up in available backends list)
2. Return a special result type indicating "external invocation required"
3. Be removed from auto-selection and only available via explicit `--backend nano_banana`

### Requirements

1. **Fix the NanoBananaBackend implementation** to resolve the confusing behavior
2. **Choose one of the following approaches**:
   - **Option A**: Make `is_available()` return `False` (backend not available for direct use)
   - **Option B**: Add a special result type or flag for "external invocation required"
   - **Option C**: Remove from auto-selection BACKEND_PRIORITIES list
3. **Update error handling** in main function to handle the chosen approach appropriately
4. **Add tests** to verify the fix works correctly
5. **Update documentation** in SKILL.md if backend behavior changes

**Acceptance Criteria**:
- [x] NanoBanana backend behavior is consistent with availability check
- [x] Users are no longer misled by "backend appears available but always fails"
- [x] Appropriate tests added and passing
- [x] Documentation updated if needed

### Q&A

**Q:** Which approach should we use to fix the NanoBanana backend behavior?
**A:** Use **Option A** - Make `is_available()` return `False` and remove nano_banana from BACKEND_PRIORITIES. This ensures it's not auto-selected and users are no longer misled.

### Design

**Chosen Approach:**
- Modified `NanoBananaBackend.is_available()` to return `False`
- Removed `nano_banana` from `ImageGenerator.BACKEND_PRIORITIES`
- Updated documentation to clarify MCP tool requirement
- Updated tests to reflect new behavior

**Files Modified:**
- `/Users/robin/projects/cc-agents/plugins/wt/skills/image-generate/scripts/image_generator.py`
- `/Users/robin/projects/cc-agents/plugins/wt/skills/image-generate/tests/test_image_generator.py`

### Plan

**Phase 1: Implementation**
- [x] Updated `NanoBananaBackend.is_available()` to return `False`
- [x] Removed `nano_banana` from `BACKEND_PRIORITIES` list
- [x] Updated module docstring to clarify MCP requirement
- [x] Updated CLI help text to remove nano_banana examples

**Phase 2: Testing**
- [x] Updated `test_is_available` to expect `False`
- [x] Updated `test_backend_priorities` to exclude nano_banana
- [x] Added `test_nano_banana_excluded_from_auto_selection`
- [x] Updated `test_select_backend_none_available` test

**Phase 3: Verification**
- [x] Tests pass successfully
- [x] NanoBanana backend no longer appears in auto-selection
- [x] Documentation updated

### Artifacts

| Type | Path | Generated By | Date |
|------|------|--------------|------|
| Code Change | `/Users/robin/projects/cc-agents/plugins/wt/skills/image-generate/scripts/image_generator.py` | super-coder | 2026-01-29 |
| Test Update | `/Users/robin/projects/cc-agents/plugins/wt/skills/image-generate/tests/test_image_generator.py` | super-coder | 2026-01-29 |

### References

- Original task: Task 0106
- Related: `plugins/wt/skills/image-generate/scripts/image_generator.py` lines 327-452 (NanoBananaBackend class)
