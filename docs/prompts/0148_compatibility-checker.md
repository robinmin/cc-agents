---
wbs: "0002"
topic: "rd2:tasks Agent Skill Upgrade"
description: "Implement version detection and tool availability checking"
status: Backlog
created_at: "2026-02-02"
updated_at: "2026-02-02"
impl_progress:
  planning: pending
  design: pending
  implementation: pending
  review: pending
  testing: pending
---

## 0148. Compatibility Checker Implementation

### Background

Claude Code environments may have different versions of the Task tools available. Some environments may have:

- Only TodoWrite (older Claude Code versions)
- TaskList/TaskGet/TaskUpdate but not TodoWrite (rare edge case)
- Both new tools and TodoWrite (most common)

The Compatibility Checker must:

1. Detect which tools are available in the current environment
2. Determine the best tool to use (prefer new tools when available)
3. Provide information for graceful fallback decisions
4. Cache availability results to avoid repeated checks

This component is critical for maintaining backward compatibility while enabling new features.

### Requirements

1. **Version Detection**: Detect Claude Code version to understand available capabilities
2. **Tool Availability Check**: Test each tool (TaskList, TaskGet, TaskUpdate, TodoWrite) for availability
3. **ToolAvailability Interface**: Return structured information:
   ```typescript
   interface ToolAvailability {
     hasNewTools: boolean;
     hasTodoWrite: boolean;
     preferredTool: "new" | "legacy" | "unknown";
     availableTools: string[];
     claudeVersion?: string;
   }
   ```
4. **Caching**: Cache availability results for session duration
5. **Refresh Capability**: Allow forced re-check of tool availability
6. **Error Handling**: Handle errors gracefully when tools are unavailable

### Q&A

[Clarifications to be added during planning phase]

### Design

[Architecture specs to be added by specialists]

### Plan

1. Define ToolAvailability interface
2. Implement version detection via Claude Code API
3. Implement tool availability checking with proper error handling
4. Add caching layer for performance
5. Create utility functions for common checks
6. Write unit tests for all scenarios

### Artifacts

| Type | Path | Generated By | Date |
| ---- | ---- | ------------ | ---- |

### References

- [Master Task: 0001_rd2-tasks-upgrade.md](/docs/prompts/0001_rd2-tasks-upgrade.md)
- [Claude Code SDK - TypeScript Reference](https://docs.claude.com/en/docs/claude-code/sdk/sdk-typescript)
